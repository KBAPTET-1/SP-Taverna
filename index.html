<?php include 'server.php'; ?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мини-Форум</title>
    <style>
        /* CSS внутри HTML */
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 40px; }
        .forum-wrapper { background: white; width: 400px; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #chat-window { 
            height: 300px; overflow-y: auto; border: 1px solid #ddd; 
            padding: 10px; margin-bottom: 15px; background: #fff;
        }
        .message { padding: 5px 0; border-bottom: 1px dotted #ccc; font-size: 14px; }
        .message strong { color: #2c3e50; }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>

<div class="forum-wrapper">
    <h2>Форум</h2>
    
    <div id="chat-window">
        <?php getMessages('messages.json'); ?>
    </div>

    <form id="postForm">
        <input type="text" id="author" placeholder="Ваше имя" required>
        <textarea id="msgContent" placeholder="Текст сообщения..." required></textarea>
        <button type="submit">Отправить</button>
    </form>
</div>

<script>
    // JS внутри HTML
    document.getElementById('postForm').onsubmit = function(e) {
        e.preventDefault();

        const name = document.getElementById('author').value;
        const text = document.getElementById('msgContent').value;
        const chatWindow = document.getElementById('chat-window');

        const data = new URLSearchParams();
        data.append('name', name);
        data.append('text', text);

        fetch('server.php', {
            method: 'POST',
            body: data
        })
        .then(response => response.text())
        .then(htmlChunk => {
            // Добавляем новое сообщение в конец списка
            chatWindow.innerHTML += htmlChunk;
            // Прокрутка вниз
            chatWindow.scrollTop = chatWindow.scrollHeight;
            // Очистка поля ввода
            document.getElementById('msgContent').value = '';
        })
        .catch(err => alert('Ошибка при отправке'));
    };
</script>

</body>
</html>
